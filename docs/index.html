<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FuncRoute Documentation</title>
    <style>
        :root {
            --primary-color: #2980b9;
            --secondary-color: #27ae60;
            --bg-color: #f8f9fa;
            --sidebar-bg: #343131;
            --sidebar-text: #b3b3b3;
            --code-bg: #f4f4f4;
            --border-color: #e1e4e8;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: var(--bg-color);
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background-color: var(--sidebar-bg);
            color: var(--sidebar-text);
            padding: 20px;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .sidebar-header {
            margin-bottom: 30px;
        }

        .sidebar-header h1 {
            color: #fff;
            font-size: 24px;
            margin-bottom: 5px;
        }

        .sidebar-header .version {
            color: var(--sidebar-text);
            font-size: 14px;
        }

        .nav-section {
            margin-bottom: 25px;
        }

        .nav-section h3 {
            color: #fff;
            font-size: 14px;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .nav-links {
            list-style: none;
        }

        .nav-links li {
            margin-bottom: 8px;
        }

        .nav-links a {
            color: var(--sidebar-text);
            text-decoration: none;
            display: block;
            padding: 5px 10px;
            border-radius: 3px;
            transition: all 0.2s;
        }

        .nav-links a:hover,
        .nav-links a.active {
            background-color: rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        /* Main Content */
        .main-content {
            margin-left: 280px;
            flex: 1;
            padding: 40px 60px;
            max-width: 1200px;
        }

        .header {
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 20px;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 36px;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .header .tagline {
            font-size: 18px;
            color: #7f8c8d;
        }

        .badges {
            margin: 20px 0;
        }

        .badge {
            display: inline-block;
            padding: 5px 10px;
            margin-right: 10px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-license {
            background-color: #f39c12;
            color: #fff;
        }

        .badge-python {
            background-color: #3498db;
            color: #fff;
        }

        .badge-version {
            background-color: #27ae60;
            color: #fff;
        }

        /* Section Styling */
        .section {
            margin-bottom: 50px;
        }

        .section h2 {
            font-size: 28px;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        .section h3 {
            font-size: 22px;
            color: #34495e;
            margin: 25px 0 15px;
        }

        .section h4 {
            font-size: 18px;
            color: #34495e;
            margin: 20px 0 10px;
        }

        /* Code Blocks */
        pre {
            background-color: var(--code-bg);
            border: 1px solid var(--border-color);
            border-radius: 5px;
            padding: 15px;
            overflow-x: auto;
            margin: 15px 0;
        }

        code {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            color: #c7254e;
            background-color: #f9f2f4;
            padding: 2px 6px;
            border-radius: 3px;
        }

        pre code {
            color: #333;
            background-color: transparent;
            padding: 0;
        }

        /* Feature Grid */
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .feature-card {
            background: #fff;
            padding: 20px;
            border-radius: 5px;
            border: 1px solid var(--border-color);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .feature-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .feature-card h4 {
            color: var(--primary-color);
            margin: 0 0 10px;
        }

        .feature-card p {
            color: #666;
            font-size: 14px;
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: #fff;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border: 1px solid var(--border-color);
        }

        th {
            background-color: var(--primary-color);
            color: #fff;
            font-weight: 600;
        }

        tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        /* Alert Boxes */
        .alert {
            padding: 15px 20px;
            border-radius: 5px;
            margin: 20px 0;
            border-left: 4px solid;
        }

        .alert-info {
            background-color: #d1ecf1;
            border-color: #0c5460;
            color: #0c5460;
        }

        .alert-success {
            background-color: #d4edda;
            border-color: #155724;
            color: #155724;
        }

        .alert-warning {
            background-color: #fff3cd;
            border-color: #856404;
            color: #856404;
        }

        /* Lists */
        ul, ol {
            margin: 15px 0;
            padding-left: 30px;
        }

        li {
            margin: 8px 0;
        }

        /* Links */
        a {
            color: var(--primary-color);
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        /* Footer */
        .footer {
            margin-top: 60px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
            color: #7f8c8d;
            font-size: 14px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }

            .main-content {
                margin-left: 0;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1>FuncRoute</h1>
                <p class="version">Version 0.1.0</p>
            </div>

            <nav class="nav-section">
                <h3>Getting Started</h3>
                <ul class="nav-links">
                    <li><a href="#overview" class="active">Overview</a></li>
                    <li><a href="#installation">Installation</a></li>
                    <li><a href="#quick-start">Quick Start</a></li>
                    <li><a href="#features">Features</a></li>
                </ul>
            </nav>

            <nav class="nav-section">
                <h3>User Guide</h3>
                <ul class="nav-links">
                    <li><a href="#training">Training Models</a></li>
                    <li><a href="#data-generation">Data Generation</a></li>
                    <li><a href="#inference">Inference</a></li>
                    <li><a href="#evaluation">Evaluation</a></li>
                </ul>
            </nav>

            <nav class="nav-section">
                <h3>Advanced</h3>
                <ul class="nav-links">
                    <li><a href="#pattern-splitting">Pattern Splitting</a></li>
                    <li><a href="#caching">Caching</a></li>
                    <li><a href="#deployment">Deployment</a></li>
                    <li><a href="#cli">CLI Reference</a></li>
                </ul>
            </nav>

            <nav class="nav-section">
                <h3>API Reference</h3>
                <ul class="nav-links">
                    <li><a href="#funcroute-class">FuncRoute</a></li>
                    <li><a href="#training-config">TrainingConfig</a></li>
                    <li><a href="#tool-definition">ToolDefinition</a></li>
                    <li><a href="#predictor">Predictor</a></li>
                </ul>
            </nav>

            <nav class="nav-section">
                <h3>Resources</h3>
                <ul class="nav-links">
                    <li><a href="#examples">Examples</a></li>
                    <li><a href="#performance">Performance</a></li>
                    <li><a href="#contributing">Contributing</a></li>
                    <li><a href="#changelog">Changelog</a></li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <div class="header" id="overview">
                <h1>FuncRoute</h1>
                <p class="tagline">Intelligent Function/Tool Routing using Fine-tuned FunctionGemma</p>

                <div class="badges">
                    <span class="badge badge-license">MIT License</span>
                    <span class="badge badge-python">Python 3.9+</span>
                    <span class="badge badge-version">v0.1.0</span>
                </div>
            </div>

            <!-- Why FuncRoute -->
            <section class="section">
                <h2>üåü Why FuncRoute?</h2>

                <p><strong>Problem:</strong> Modern AI agents need to route user queries to the right tool/function among dozens of options. Traditional approaches using massive LLMs are:</p>

                <ul>
                    <li>üí∏ <strong>Expensive</strong> ($0.10+ per 1000 queries)</li>
                    <li>üêå <strong>Slow</strong> (1-3 seconds per query)</li>
                    <li>üéØ <strong>Inconsistent</strong> (hallucinations, wrong tools)</li>
                </ul>

                <div class="alert alert-success">
                    <strong>FuncRoute Solution:</strong>
                    <ul style="margin-top: 10px;">
                        <li>üí∞ <strong>99% cheaper</strong> (fine-tuned 270M model vs GPT-4)</li>
                        <li>‚ö° <strong>10-100x faster</strong> (50-200ms per query)</li>
                        <li>üéØ <strong>More accurate</strong> (98%+ with proper training)</li>
                        <li>üîí <strong>Self-hosted</strong> (no API costs, full control)</li>
                    </ul>
                </div>
            </section>

            <!-- Installation -->
            <section class="section" id="installation">
                <h2>üì¶ Installation</h2>

                <h3>From PyPI</h3>
                <pre><code>pip install funcroute</code></pre>

                <h3>From Source</h3>
                <pre><code>git clone https://github.com/yourusername/funcroute.git
cd funcroute
pip install -e .</code></pre>

                <h3>Requirements</h3>
                <ul>
                    <li>Python 3.9+</li>
                    <li>PyTorch 2.0+</li>
                    <li>CUDA GPU (recommended, 8GB+ VRAM)</li>
                    <li>CPU supported but 10x slower</li>
                </ul>
            </section>

            <!-- Quick Start -->
            <section class="section" id="quick-start">
                <h2>üéØ Quick Start</h2>

                <h3>Complete Workflow</h3>
                <pre><code>from funcroute import FuncRoute, TrainingConfig
from funcroute.core.config import ToolDefinition
from funcroute.data.generator import SyntheticDataGenerator
from funcroute.data.splitter import PatternGroupSplitter

# Step 1: Define your tools
tools = [
    ToolDefinition(
        name="manage_order",
        signature="manage_order(order_id: str) -> dict",
        description="Track and manage customer orders",
        examples=["Where is my order?", "Track package"],
        keywords=["order", "track", "delivery"],
    ),
    # ... more tools
]

# Step 2: Generate synthetic data
generator = SyntheticDataGenerator(method="rule_based")
data = generator.generate(tools=tools, num_variations=50, num_samples=5000)

# Step 3: Split with anti-leakage
splitter = PatternGroupSplitter(seed=42)
train_data, val_data, test_data = splitter.split(data, verify_no_leakage=True)

# Step 4: Train the model
router = FuncRoute()
router.train(
    train_data=train_data,
    val_data=val_data,
    tools=tools,
    config=TrainingConfig(
        output_dir="./my_router",
        num_epochs=3,
        batch_size=4,
    ),
)

# Step 5: Make predictions
result = router.route("Where is my package?")
print(f"Tool: {result.tool}")           # manage_order
print(f"Confidence: {result.confidence:.1%}")  # 98.5%</code></pre>

                <h3>Using Pre-trained Model</h3>
                <pre><code>from funcroute import FuncRoute

# Load from Hugging Face Hub
router = FuncRoute.from_pretrained("scionoftech/functiongemma-e-commerce-tool-calling")

# Route queries
result = router.route("Where is my order?")
print(f"Tool: {result.tool}")  # manage_order</code></pre>
            </section>

            <!-- Features -->
            <section class="section" id="features">
                <h2>üöÄ Features</h2>

                <div class="feature-grid">
                    <div class="feature-card">
                        <h4>Easy Training</h4>
                        <p>Fine-tune FunctionGemma with your own data in minutes using LoRA + 4-bit quantization.</p>
                    </div>

                    <div class="feature-card">
                        <h4>Synthetic Data</h4>
                        <p>Generate thousands of training samples automatically with rule-based pattern expansion.</p>
                    </div>

                    <div class="feature-card">
                        <h4>Anti-Leakage</h4>
                        <p>Pattern group splitting prevents data leakage and overfitting between train/val/test sets.</p>
                    </div>

                    <div class="feature-card">
                        <h4>Fast Inference</h4>
                        <p>Batch prediction, streaming, and async support for maximum throughput.</p>
                    </div>

                    <div class="feature-card">
                        <h4>Caching</h4>
                        <p>LRU cache with TTL provides 5-10x speedup for repeated queries.</p>
                    </div>

                    <div class="feature-card">
                        <h4>REST API</h4>
                        <p>Production-ready FastAPI server with OpenAPI documentation.</p>
                    </div>
                </div>
            </section>

            <!-- Training -->
            <section class="section" id="training">
                <h2>Training Models</h2>

                <h3>Basic Training</h3>
                <pre><code>from funcroute import FuncRoute, TrainingConfig

router = FuncRoute()
router.train(
    train_data="train.jsonl",
    val_data="val.jsonl",
    tools=tools,  # CRITICAL: Must provide tool definitions
    config=TrainingConfig(
        output_dir="./my_router",
        num_epochs=3,
        batch_size=4,
        learning_rate=2e-4,
    ),
)</code></pre>

                <h3>TrainingConfig Parameters</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Default</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>output_dir</code></td>
                            <td><em>Required</em></td>
                            <td>Directory to save model</td>
                        </tr>
                        <tr>
                            <td><code>num_epochs</code></td>
                            <td>3</td>
                            <td>Number of training epochs</td>
                        </tr>
                        <tr>
                            <td><code>batch_size</code></td>
                            <td>4</td>
                            <td>Batch size per device</td>
                        </tr>
                        <tr>
                            <td><code>learning_rate</code></td>
                            <td>2e-4</td>
                            <td>Learning rate</td>
                        </tr>
                        <tr>
                            <td><code>eval_strategy</code></td>
                            <td>"epoch"</td>
                            <td>When to evaluate ("epoch" or "steps")</td>
                        </tr>
                        <tr>
                            <td><code>save_steps</code></td>
                            <td>None</td>
                            <td>Save checkpoint every N steps</td>
                        </tr>
                        <tr>
                            <td><code>lora_r</code></td>
                            <td>16</td>
                            <td>LoRA rank</td>
                        </tr>
                        <tr>
                            <td><code>quantization</code></td>
                            <td>"4bit"</td>
                            <td>Quantization mode ("4bit", "8bit", None)</td>
                        </tr>
                    </tbody>
                </table>

                <div class="alert alert-info">
                    <strong>Note:</strong> See <code>API_REFERENCE_TRAININGCONFIG.md</code> for all 25 parameters.
                </div>
            </section>

            <!-- Data Generation -->
            <section class="section" id="data-generation">
                <h2>Data Generation</h2>

                <h3>Synthetic Data Generation</h3>
                <pre><code>from funcroute.data.generator import SyntheticDataGenerator

generator = SyntheticDataGenerator(method="rule_based")
data = generator.generate(
    tools=tools,
    num_variations=50,  # 50 variations per pattern
    num_samples=5000,   # Target ~5000 total samples
)

print(f"Generated {len(data)} samples")
# Generated 5000 samples</code></pre>

                <h3>Data Format</h3>
                <pre><code># JSONL format
{"query": "Where is my order?", "tool": "manage_order"}
{"query": "Show me red dresses", "tool": "search_products"}
{"query": "Return this item", "tool": "process_return"}</code></pre>
            </section>

            <!-- Pattern Splitting -->
            <section class="section" id="pattern-splitting">
                <h2>Pattern Group Splitting (Anti-Leakage)</h2>

                <p><strong>Problem:</strong> Random splitting can leak pattern variations between train/test, causing inflated accuracy.</p>

                <p><strong>Solution:</strong> FuncRoute groups similar queries and splits by groups, not individual samples.</p>

                <pre><code>from funcroute.data.splitter import PatternGroupSplitter

splitter = PatternGroupSplitter(seed=42)
train, val, test = splitter.split(
    data,
    train_ratio=0.7,
    val_ratio=0.15,
    test_ratio=0.15,
    verify_no_leakage=True,  # Automatic verification
)

# Output:
# Pattern Group Splitting:
#   Total groups: 150
#   Train groups: 105 (3500 samples)
#   Val groups: 22 (750 samples)
#   Test groups: 23 (750 samples)
# ‚úÖ NO DATA LEAKAGE - Splits are clean!</code></pre>
            </section>

            <!-- Inference -->
            <section class="section" id="inference">
                <h2>Inference</h2>

                <h3>Single Prediction</h3>
                <pre><code>result = router.route("Where is my order?")
print(f"Tool: {result.tool}")
print(f"Confidence: {result.confidence:.1%}")
print(f"Latency: {result.latency_ms:.1f}ms")</code></pre>

                <h3>Batch Prediction</h3>
                <pre><code>from funcroute.inference import Predictor

predictor = Predictor(router)
results = predictor.predict_batch(
    queries=["Query 1", "Query 2", ...],
    max_workers=4,
    show_progress=True,
)</code></pre>

                <h3>Async Prediction</h3>
                <pre><code>import asyncio

result = await predictor.predict_async("Where is my order?")</code></pre>
            </section>

            <!-- Caching -->
            <section class="section" id="caching">
                <h2>Caching</h2>

                <h3>LRU Cache with TTL</h3>
                <pre><code>from funcroute.inference import RouteCache, Predictor

cache = RouteCache(max_size=1000, ttl_seconds=3600)
predictor = Predictor(router, cache=cache)

# First call: miss (150ms)
result1 = predictor._predict_single("Where is my order?")

# Second call: hit (< 1ms)
result2 = predictor._predict_single("Where is my order?")

# Cache statistics
stats = cache.get_stats()
print(f"Hit rate: {stats['hit_rate']:.1%}")  # 50.0%</code></pre>

                <h3>Cache Warmup</h3>
                <pre><code>from funcroute.inference import WarmupCache

warmup = WarmupCache(predictor)
common_queries = ["Where is my order?", "Track package", ...]
warmup.warmup(common_queries)</code></pre>
            </section>

            <!-- Deployment -->
            <section class="section" id="deployment">
                <h2>Deployment</h2>

                <h3>REST API Server</h3>
                <pre><code># Start server
funcroute serve --model ./my_router --port 8000</code></pre>

                <h3>API Endpoints</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Endpoint</th>
                            <th>Method</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>/route</code></td>
                            <td>POST</td>
                            <td>Single query routing</td>
                        </tr>
                        <tr>
                            <td><code>/route/batch</code></td>
                            <td>POST</td>
                            <td>Batch query routing</td>
                        </tr>
                        <tr>
                            <td><code>/health</code></td>
                            <td>GET</td>
                            <td>Health check</td>
                        </tr>
                        <tr>
                            <td><code>/stats</code></td>
                            <td>GET</td>
                            <td>Server statistics</td>
                        </tr>
                        <tr>
                            <td><code>/cache/stats</code></td>
                            <td>GET</td>
                            <td>Cache statistics</td>
                        </tr>
                    </tbody>
                </table>

                <h3>cURL Examples</h3>
                <pre><code># Single prediction
curl -X POST http://localhost:8000/route \
  -H "Content-Type: application/json" \
  -d '{"query": "Where is my order?"}'

# Batch prediction
curl -X POST http://localhost:8000/route/batch \
  -H "Content-Type: application/json" \
  -d '{"queries": ["Where is my order?", "Show me laptops"]}'</code></pre>
            </section>

            <!-- Examples -->
            <section class="section" id="examples">
                <h2>üìä Examples</h2>

                <p>We provide 9 comprehensive examples demonstrating all features:</p>

                <ol>
                    <li><strong>simple_example.py</strong> - Complete workflow with 5000 samples</li>
                    <li><strong>batch_prediction_example.py</strong> - 7 batch processing patterns</li>
                    <li><strong>streaming_prediction_example.py</strong> - 7 streaming patterns</li>
                    <li><strong>async_prediction_example.py</strong> - 9 async/await patterns</li>
                    <li><strong>caching_example.py</strong> - 8 caching strategies</li>
                    <li><strong>evaluation_example.py</strong> - Metrics and cross-validation</li>
                    <li><strong>synthetic_data_example.py</strong> - Data generation</li>
                    <li><strong>server_example.py</strong> - REST API deployment</li>
                    <li><strong>test_imports.py</strong> - Import verification</li>
                </ol>

                <pre><code># Run examples
cd examples
python simple_example.py</code></pre>
            </section>

            <!-- API Reference -->
            <section class="section" id="funcroute-class">
                <h2>API Reference</h2>

                <h3>FuncRoute Class</h3>
                <pre><code>class FuncRoute:
    def __init__(self, device: str = "auto"):
        """Initialize FuncRoute router."""

    def train(
        self,
        train_data: Union[str, List[Dict]],
        val_data: Optional[Union[str, List[Dict]]] = None,
        tools: Optional[List[ToolDefinition]] = None,
        config: Optional[TrainingConfig] = None,
    ):
        """Train the routing model."""

    @classmethod
    def load(cls, model_path: str, device: str = "auto") -> "FuncRoute":
        """Load a trained model."""

    @classmethod
    def from_pretrained(cls, model_name: str, device: str = "auto") -> "FuncRoute":
        """Load a pre-trained model from Hugging Face Hub."""

    def route(self, query: str, config: Optional[InferenceConfig] = None) -> RouteResult:
        """Route a query to the best tool."""</code></pre>
            </section>

            <!-- Contributing -->
            <section class="section" id="contributing">
                <h2>ü§ù Contributing</h2>

                <p>We welcome contributions! Please see <code>CONTRIBUTING.md</code> for guidelines.</p>

                <h3>Development Setup</h3>
                <pre><code>git clone https://github.com/yourusername/funcroute.git
cd funcroute
pip install -e ".[dev]"
pytest tests/</code></pre>

                <h3>Areas for Contribution</h3>
                <ul>
                    <li>üìù Documentation improvements</li>
                    <li>üêõ Bug fixes and issue reports</li>
                    <li>‚ú® New examples and use cases</li>
                    <li>üîß Performance optimizations</li>
                    <li>üåê Framework integrations</li>
                </ul>
            </section>

            <!-- Footer -->
            <div class="footer">
                <p>&copy; 2025 FuncRoute. Released under the MIT License.</p>
                <p>Built with ‚ù§Ô∏è for the AI agent community</p>
            </div>
        </main>
    </div>

    <script>
        // Smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth', block: 'start' });

                    // Update active link
                    document.querySelectorAll('.nav-links a').forEach(link => {
                        link.classList.remove('active');
                    });
                    this.classList.add('active');
                }
            });
        });

        // Update active link on scroll
        window.addEventListener('scroll', () => {
            const sections = document.querySelectorAll('.section');
            const navLinks = document.querySelectorAll('.nav-links a');

            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                const sectionHeight = section.clientHeight;
                if (window.pageYOffset >= sectionTop - 100) {
                    current = section.getAttribute('id');
                }
            });

            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === `#${current}`) {
                    link.classList.add('active');
                }
            });
        });
    </script>
</body>
</html>
